<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Model Performance Comparison — A vs B</title>
  <style>
    :root{--bg:#0f1724;--card:#111827;--muted:#9CA3AF;--accent:#60a5fa;--glass:rgba(255,255,255,0.03)}
    html,body{height:100%;margin:0;font-family:Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;background:linear-gradient(180deg,#071029 0%, #0b1220 100%);color:#e6eef8}
    .container{max-width:1100px;margin:28px auto;padding:24px}
    header{display:flex;gap:16px;align-items:center}
    h1{margin:0;font-size:20px}
    .subtitle{color:var(--muted);font-size:13px}
    .grid{display:grid;grid-template-columns:1fr 360px;gap:20px;margin-top:18px}
    .card{background:var(--card);border-radius:12px;padding:16px;box-shadow:0 6px 20px rgba(2,6,23,0.6)}
    .small{font-size:13px;color:var(--muted)}
    canvas{width:100%!important;height:300px!important}
    table{width:100%;border-collapse:collapse;color:#e6eef8;font-size:13px}
    th,td{padding:8px;text-align:left;border-bottom:1px solid rgba(255,255,255,0.03)}
    th{color:var(--muted);font-weight:600}
    .row{display:flex;gap:12px;align-items:center}
    .pill{background:var(--glass);padding:6px 10px;border-radius:999px;font-size:13px;color:var(--muted)}
    .summary{display:flex;gap:12px;flex-wrap:wrap}
    .summary .metric{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));padding:12px;border-radius:10px;min-width:150px}
    .button{background:var(--accent);color:#02203a;padding:8px 12px;border:none;border-radius:8px;cursor:pointer;font-weight:700}
    .danger{background:#ef4444}
    .muted{color:var(--muted)}
    footer{margin-top:20px;color:var(--muted);font-size:13px}
    @media (max-width:980px){.grid{grid-template-columns:1fr;}
      canvas{height:260px!important}
    }
  </style>
  <!-- Chart.js CDN -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.3.0/dist/chart.umd.min.js"></script>
</head>
<body>
  <div class="container">
    <header>
      <div>
        <h1>Pure SOTA Model vs Trained Model — Performance comparison</h1>
        <div class="subtitle">Per-class precision / recall / F1 and overall accuracy (interactive)</div>
      </div>
      <div style="margin-left:auto;text-align:right">
        <div class="pill">Images evaluated: 204</div>
      </div>
    </header>

    <div class="grid">
      <main>
        <div class="card">
          <div class="row" style="justify-content:space-between;align-items:flex-start">
            <div>
              <div class="small">Overall snapshot</div>
              <div style="font-size:18px;font-weight:700;margin-top:6px">Pure SOTA Model → Trained Model</div>
            </div>
            <div style="text-align:right">
              <div class="small">Overall accuracy</div>
              <div id="overallAccuracy" style="font-size:18px;font-weight:800;margin-top:6px">—</div>
            </div>
          </div>

          <hr style="margin:12px 0;border-color:rgba(255,255,255,0.04)">

          <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px">
            <div class="summary">
              <div class="metric">
                <div class="muted">Pure SOTA Model accuracy</div>
                <div id="modelAAcc" style="font-weight:800;font-size:18px;margin-top:6px">0%</div>
              </div>
              <div class="metric">
                <div class="muted">Trained Model accuracy</div>
                <div id="modelBAcc" style="font-weight:800;font-size:18px;margin-top:6px">0%</div>
              </div>
            </div>
            <div style="display:flex;flex-direction:column;gap:8px;justify-content:center">
              <button class="button" id="toggleDelta">Show deltas</button>
              <button class="button" id="downloadCsv">Download CSV</button>
            </div>
          </div>

        </div>

        <div class="card" style="margin-top:16px">
          <div style="display:flex;gap:10px;align-items:center;justify-content:space-between">
            <div><strong>Grouped per-class metrics</strong><div class="small">Precision / Recall / F1 per class for both models</div></div>
            <div class="small">Toggle series below</div>
          </div>
          <canvas id="groupedBars"></canvas>
        </div>

        <div class="card" style="margin-top:16px">
          <div style="display:flex;justify-content:space-between;align-items:center">
            <div><strong>F1 Radar</strong><div class="small">F1 score across classes (visual comparing)</div></div>
            <div class="small">Zooms on per-class F1 differences</div>
          </div>
          <canvas id="f1Radar"></canvas>
        </div>

      </main>

      <aside>
        <div class="card">
          <div style="display:flex;justify-content:space-between;align-items:center">
            <div><strong>Quick facts</strong></div>
            <div class="small muted">Support = ground truth count</div>
          </div>

          <table style="margin-top:12px">
            <thead><tr><th>Class</th><th>Pure SOTA Model F1</th><th>Trained Model F1</th><th>Δ F1</th><th>Support</th></tr></thead>
            <tbody id="summaryTable"></tbody>
          </table>

          <hr style="margin:10px 0;border-color:rgba(255,255,255,0.04)">
          <div class="small muted">Notes</div>
          <ul style="font-size:13px">
            <li>Trained Model shows large recall fixes for <strong>book</strong> and near-perfect detection for <strong>cup</strong> & <strong>chair</strong>.</li>
            <li>Pure SOTA Model had low recall for books (many false negatives).</li>
            <li>Precision drops where recall rose slightly (e.g. laptop), indicating a sensitivity/threshold tradeoff.</li>
          </ul>
        </div>

        <div class="card" style="margin-top:16px">
          <div><strong>Raw per-class numbers</strong></div>
          <pre id="rawJson" style="white-space:pre-wrap;margin-top:8px;font-size:12px;color:var(--muted)"></pre>
        </div>
      </aside>
    </div>

    <footer>
      <div class="small muted">Interactive analysis generated from provided evaluation dumps. Use the CSV export to plug into other tools.</div>
    </footer>
  </div>

  <script>
  // --- Data from the two JSONs ---
  const modelA = {
    overall_accuracy: 0.6813725490196079,
    num_images: 204,
    per_class: [
      {className: 'book', precision:1.0, recall:0.08823529411764706, f1:0.16216216216216217, support:34},
      {className: 'bottle', precision:0.575, recall:0.8846153846153846, f1:0.696969696969697, support:52},
      {className: 'chair', precision:0.9565217391304348, recall:0.8148148148148148, f1:0.88, support:27},
      {className: 'cup', precision:0.9767441860465116, recall:0.6885245901639344, f1:0.8076923076923077, support:61},
      {className: 'laptop', precision:0.9629629629629629, recall:0.8666666666666667, f1:0.9122807017543859, support:30}
    ]
  };

  const modelB = {
    overall_accuracy: 0.9607843137254902,
    num_images: 204,
    per_class: [
      {className: 'book', precision:0.9642857142857143, recall:0.7941176470588235, f1:0.8709677419354839, support:34},
      {className: 'bottle', precision:0.9622641509433962, recall:0.9807692307692307, f1:0.9714285714285714, support:52},
      {className: 'chair', precision:0.9642857142857143, recall:1.0, f1:0.9818181818181818, support:27},
      {className: 'cup', precision:1.0, recall:1.0, f1:1.0, support:61},
      {className: 'laptop', precision:0.8823529411764706, recall:1.0, f1:0.9375, support:30}
    ]
  };

  // --- UI wiring ---
  document.getElementById('modelAAcc').textContent = (modelA.overall_accuracy*100).toFixed(2) + '%';
  document.getElementById('modelBAcc').textContent = (modelB.overall_accuracy*100).toFixed(2) + '%';
  document.getElementById('overallAccuracy').innerHTML = modelA.overall_accuracy.toFixed(3) + ' → <strong>' + modelB.overall_accuracy.toFixed(3) + '</strong>';

  document.getElementById('rawJson').textContent = JSON.stringify({modelA, modelB}, null, 2);

  // Build summary table rows
  const summaryTable = document.getElementById('summaryTable');
  modelA.per_class.forEach((rowA,i)=>{
    const rowB = modelB.per_class[i];
    const delta = (rowB.f1 - rowA.f1);
    const tr = document.createElement('tr');
    tr.innerHTML = `<td>${rowA.className}</td><td>${rowA.f1.toFixed(3)}</td><td>${rowB.f1.toFixed(3)}</td><td style="color:${delta>0? '#7ee787':'#ff9b9b'}">${delta>0?'+':''}${delta.toFixed(3)}</td><td>${rowA.support}</td>`;
    summaryTable.appendChild(tr);
  });

  // --- Chart 1: grouped bars for precision/recall/f1 per class per model ---
  const classes = modelA.per_class.map(c=>c.className);
  function seriesFrom(model, metric){
    return model.per_class.map(x=>+(x[metric]*100).toFixed(2));
  }

  const groupedCtx = document.getElementById('groupedBars').getContext('2d');
  const groupedChart = new Chart(groupedCtx, {
    type: 'bar',
    data: {
      labels: classes,
      datasets: [
        {label: 'A — Precision', data: seriesFrom(modelA,'precision'), stack: 'A', backgroundColor: 'rgba(96,165,250,0.9)'},
        {label: 'A — Recall', data: seriesFrom(modelA,'recall'), stack: 'A', backgroundColor: 'rgba(96,165,250,0.6)'},
        {label: 'A — F1', data: seriesFrom(modelA,'f1'), stack: 'A', backgroundColor: 'rgba(96,165,250,0.35)'},

        {label: 'B — Precision', data: seriesFrom(modelB,'precision'), stack: 'B', backgroundColor: 'rgba(34,197,94,0.9)'},
        {label: 'B — Recall', data: seriesFrom(modelB,'recall'), stack: 'B', backgroundColor: 'rgba(34,197,94,0.6)'},
        {label: 'B — F1', data: seriesFrom(modelB,'f1'), stack: 'B', backgroundColor: 'rgba(34,197,94,0.35)'}
      ]
    },
    options: {
      responsive:true,
      scales: {
        x: {stacked:false,ticks:{color:'#cbd5e1'}},
        y: {beginAtZero:true,max:110,ticks:{color:'#cbd5e1',callback: v=>v+'%'}}
      },
      plugins: {legend:{position:'top'}}
    }
  });

  // --- Chart 2: radar for F1 comparison ---
  const radarCtx = document.getElementById('f1Radar').getContext('2d');
  const radarChart = new Chart(radarCtx, {
    type: 'radar',
    data: {
      labels: classes,
      datasets: [
        {label: 'Pure SOTA Model F1', data: modelA.per_class.map(c=>+(c.f1*100).toFixed(2)), fill:true, backgroundColor:'rgba(96,165,250,0.15)', borderColor:'rgba(96,165,250,0.9)'} ,
        {label: 'Trained Model F1', data: modelB.per_class.map(c=>+(c.f1*100).toFixed(2)), fill:true, backgroundColor:'rgba(34,197,94,0.15)', borderColor:'rgba(34,197,94,0.9)'}
      ]
    },
    options:{
      scales:{r:{beginAtZero:true,max:110,pointLabels:{color:'#cbd5e1'},ticks:{color:'#cbd5e1',callback:v=>v+'%'}}},
      plugins:{legend:{position:'top'}}
    }
  });

  // Toggle delta highlighting on table and charts
  let showDelta = false;
  document.getElementById('toggleDelta').addEventListener('click', ()=>{
    showDelta = !showDelta;
    document.getElementById('toggleDelta').textContent = showDelta? 'Hide deltas':'Show deltas';
    // highlight table rows that improved > 0.1
    Array.from(summaryTable.children).forEach(tr=>{
      const cells = tr.querySelectorAll('td');
      const deltaVal = parseFloat(cells[3].textContent);
      tr.style.background = (showDelta && deltaVal>0.1)? 'linear-gradient(90deg, rgba(34,197,94,0.08), transparent)': 'transparent';
    });
  });

  // CSV download
  document.getElementById('downloadCsv').addEventListener('click', ()=>{
    const header = ['class','support','A_precision','A_recall','A_f1','B_precision','B_recall','B_f1'];
    const rows = modelA.per_class.map((c,i)=>{
      const b = modelB.per_class[i];
      return [c.className,c.support,c.precision,c.recall,c.f1,b.precision,b.recall,b.f1].join(',');
    });
    const csv = [header.join(','), ...rows].join('\n');
    const blob = new Blob([csv], {type:'text/csv'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url; a.download = 'model_comparison.csv';
    document.body.appendChild(a); a.click(); a.remove();
    URL.revokeObjectURL(url);
  });

  // small automated diagnosis snippet (textual explanation)
  function diagnosis(){
    const problems = [];
    const bookRecallA = modelA.per_class.find(x=>x.className==='book').recall;
    if(bookRecallA < 0.2) problems.push('Book recall is critically low in Pure SOTA Model — many false negatives.');
    const bottlePrecA = modelA.per_class.find(x=>x.className==='bottle').precision;
    if(bottlePrecA < 0.7) problems.push('Bottle precision low in Pure SOTA Model — many false positives.');
    return problems;
  }
  const diag = diagnosis();
  if(diag.length){
    const note = document.createElement('div');
    note.style.marginTop='10px'; note.className='small'; note.textContent = 'Auto-diagnosis: ' + diag.join(' ');
    document.querySelector('main .card').appendChild(note);
  }

  </script>
</body>
</html>
